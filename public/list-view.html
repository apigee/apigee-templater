<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Apigee Templater</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            body {
                font-family: "Inter", sans-serif;
                background-color: #111827; /* Dark blue-gray background */
                color: #e5e7eb; /* Light gray text */
            }
            /* Custom scrollbar for a more modern feel */
            ::-webkit-scrollbar {
                width: 8px;
            }
            ::-webkit-scrollbar-track {
                background: #1f2937;
            }
            ::-webkit-scrollbar-thumb {
                background: #4b5563;
                border-radius: 10px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #6b7280;
            }

            /* Glassmorphism effect for modals */
            .modal-glass {
                background: rgba(31, 41, 55, 0.7);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            /* Fancy button gradient and hover effect */
            .btn-fancy {
                background-image: linear-gradient(to right, #3b82f6, #8b5cf6);
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px 0 rgba(70, 115, 236, 0.35);
            }
            .btn-fancy:hover {
                background-position: right center;
                box-shadow: 0 6px 20px 0 rgba(139, 92, 246, 0.4);
                transform: translateY(-2px);
            }

            /* Custom toggle switch */
            .toggle-checkbox:checked {
                right: 0;
                border-color: #8b5cf6;
            }
            .toggle-checkbox:checked + .toggle-label {
                background-color: #8b5cf6;
            }

            .modal {
                transition:
                    opacity 0.3s ease,
                    transform 0.3s ease;
            }
            .modal.hidden {
                opacity: 0;
                transform: scale(0.95);
                pointer-events: none;
            }
        </style>
    </head>
    <body class="antialiased">
        <div id="app" class="min-h-screen flex flex-col">
            <!-- Header -->
            <header
                class="bg-gray-900/50 backdrop-blur-sm border-b border-gray-700/50 sticky top-0 z-20"
            >
                <div
                    class="container mx-auto px-6 py-4 flex justify-between items-center"
                >
                    <h1 class="text-2xl font-bold text-white tracking-tight">
                        <span class="text-blue-400">Apigee</span
                        ><span class="text-purple-400">Templater</span>
                    </h1>
                    <button
                        id="manageFeaturesBtn"
                        class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out"
                    >
                        Manage Features
                    </button>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-grow container mx-auto px-6 py-8">
                <div
                    class="flex justify-between items-center mb-8 flex-wrap gap-4"
                >
                    <h2 class="text-3xl font-bold text-white">Your APIs</h2>
                    <div>
                        <label
                            for="uploadApiInput"
                            class="btn-fancy text-white font-bold py-3 px-6 rounded-lg cursor-pointer inline-flex items-center"
                        >
                            <svg
                                class="w-5 h-5 mr-2"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                                ></path>
                            </svg>
                            Upload New API
                        </label>
                        <input
                            id="uploadApiInput"
                            type="file"
                            class="hidden"
                            accept=".zip,.json,.yaml,.yml"
                        />
                    </div>
                </div>

                <!-- API List -->
                <div
                    id="apiList"
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                >
                    <!-- API cards will be injected here -->
                </div>
                <div
                    id="emptyState"
                    class="hidden text-center py-20 bg-gray-800/50 rounded-lg"
                >
                    <svg
                        class="mx-auto h-12 w-12 text-gray-500"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        aria-hidden="true"
                    >
                        <path
                            vector-effect="non-scaling-stroke"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"
                        />
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-white">No APIs</h3>
                    <p class="mt-1 text-sm text-gray-400">
                        Get started by uploading your first API proxy.
                    </p>
                </div>
            </main>

            <!-- Footer -->
            <footer class="bg-gray-900/50 mt-12 border-t border-gray-700/50">
                <div
                    class="container mx-auto px-6 py-4 text-center text-gray-400 text-sm"
                >
                    &copy; 2025 Your Company Inc. All rights reserved. Built for
                    modern API Management.
                </div>
            </footer>

            <!-- Manage Features Modal -->
            <div
                id="featuresModal"
                class="modal hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-30 p-4"
            >
                <div
                    class="modal-glass w-full max-w-2xl rounded-2xl shadow-2xl transform transition-all"
                >
                    <div class="p-8">
                        <div class="flex justify-between items-start">
                            <h3 class="text-2xl font-bold text-white mb-6">
                                Manage Features
                            </h3>
                            <button
                                onclick="closeModal('featuresModal')"
                                class="text-gray-400 hover:text-white transition"
                            >
                                &times;
                            </button>
                        </div>

                        <div class="mb-6">
                            <label
                                for="uploadFeatureInput"
                                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg cursor-pointer inline-flex items-center w-full justify-center text-center transition"
                            >
                                <svg
                                    class="w-5 h-5 mr-2"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                                    ></path>
                                </svg>
                                Upload Features
                            </label>
                        </div>
                        <input
                            id="uploadFeatureInput"
                            type="file"
                            class="hidden"
                            accept=".json"
                        />

                        <div
                            id="featureList"
                            class="space-y-3 max-h-80 overflow-y-auto pr-2"
                        >
                            <!-- Feature items will be injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Details Modal -->
            <div
                id="apiDetailsModal"
                class="modal hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-30 p-4"
            >
                <div
                    class="modal-glass w-full max-w-3xl rounded-2xl shadow-2xl transform transition-all"
                >
                    <div class="p-8">
                        <div class="flex justify-between items-start">
                            <div class="mb-6">
                                <h3
                                    id="modalApiName"
                                    class="text-3xl font-bold text-white"
                                >
                                    API Name
                                </h3>
                                <p
                                    id="modalApiBasePath"
                                    class="text-gray-400 font-mono"
                                ></p>
                            </div>
                            <button
                                onclick="closeModal('apiDetailsModal')"
                                class="text-gray-400 hover:text-white transition text-2xl"
                            >
                                &times;
                            </button>
                        </div>

                        <h4 class="text-lg font-semibold text-white mb-4">
                            Toggle Features
                        </h4>
                        <div
                            id="modalFeatureToggles"
                            class="space-y-4 max-h-60 overflow-y-auto pr-2 mb-8"
                        >
                            <!-- Feature toggles will be injected here -->
                        </div>

                        <div
                            class="flex flex-wrap gap-4 justify-between items-center"
                        >
                            <div>
                                <span
                                    class="text-lg font-semibold text-white mr-4"
                                    >Download As:</span
                                >
                                <button
                                    onclick="downloadApi('json')"
                                    class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300"
                                >
                                    JSON
                                </button>
                                <button
                                    onclick="downloadApi('yaml')"
                                    class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300"
                                >
                                    YAML
                                </button>
                                <button
                                    onclick="downloadApi('zip')"
                                    class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300"
                                >
                                    ZIP
                                </button>
                            </div>
                            <button
                                id="removeApiBtn"
                                class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition"
                            >
                                Remove API
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // --- STATE MANAGEMENT ---
            let features = [
                {
                    id: 1,
                    name: "OAuth v2.0",
                    description: "Enables OAuth 2.0 security policy.",
                },
                {
                    id: 2,
                    name: "Spike Arrest",
                    description: "Protects against traffic spikes.",
                },
                {
                    id: 3,
                    name: "Response Cache",
                    description: "Caches responses for faster delivery.",
                },
            ];

            let apis = [
                {
                    id: 1,
                    name: "Products API",
                    basePath: "/v1/products",
                    activeFeatures: [1, 3],
                },
                {
                    id: 2,
                    name: "Customers API",
                    basePath: "/v2/customers",
                    activeFeatures: [2],
                },
                {
                    id: 3,
                    name: "Orders API",
                    basePath: "/v1/orders",
                    activeFeatures: [1, 2, 3],
                },
            ];

            let activeApiId = null;

            // --- DOM ELEMENTS ---
            const manageFeaturesBtn =
                document.getElementById("manageFeaturesBtn");
            const featuresModal = document.getElementById("featuresModal");
            const apiDetailsModal = document.getElementById("apiDetailsModal");
            const apiList = document.getElementById("apiList");
            const featureList = document.getElementById("featureList");
            const uploadApiInput = document.getElementById("uploadApiInput");
            const uploadFeatureInput =
                document.getElementById("uploadFeatureInput");
            const emptyState = document.getElementById("emptyState");
            const removeApiBtn = document.getElementById("removeApiBtn");

            // --- MODAL CONTROLS ---
            function openModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.remove("hidden");
            }

            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.add("hidden");
            }

            // --- RENDER FUNCTIONS ---
            function renderFeatures() {
                featureList.innerHTML = "";
                if (features.length === 0) {
                    featureList.innerHTML = `<p class="text-gray-400 text-center">No features uploaded yet.</p>`;
                    return;
                }
                features.forEach((feature) => {
                    const featureEl = document.createElement("div");
                    featureEl.className =
                        "bg-gray-700/50 p-4 rounded-lg flex justify-between items-center";
                    featureEl.innerHTML = `
                    <div>
                        <h5 class="font-bold text-white">${feature.name}</h5>
                        <p class="text-sm text-gray-400">${feature.description}</p>
                    </div>
                    <div class="flex items-center gap-4 flex-shrink-0">
                        <button onclick="downloadSingleFeature(${feature.id})" class="text-blue-400 hover:text-blue-300 font-semibold text-sm transition">Download</button>
                        <button onclick="removeFeature(${feature.id})" class="text-red-400 hover:text-red-300 font-semibold text-sm transition">&times; Remove</button>
                    </div>
                `;
                    featureList.appendChild(featureEl);
                });
            }

            function renderApis() {
                apiList.innerHTML = "";
                if (apis.length === 0) {
                    emptyState.classList.remove("hidden");
                    apiList.classList.add("hidden");
                } else {
                    emptyState.classList.add("hidden");
                    apiList.classList.remove("hidden");
                    apis.forEach((api) => {
                        const apiCard = document.createElement("div");
                        apiCard.className =
                            "bg-gray-800/60 rounded-xl p-6 shadow-lg hover:shadow-purple-500/20 hover:border-purple-500/50 border border-transparent transition-all duration-300 cursor-pointer";
                        apiCard.onclick = () => showApiDetails(api.id);

                        const activeFeaturesHtml = api.activeFeatures
                            .map((featureId) => {
                                const feature = features.find(
                                    (f) => f.id === featureId,
                                );
                                return feature
                                    ? `<span class="bg-purple-600/50 text-purple-200 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">${feature.name}</span>`
                                    : "";
                            })
                            .join("");

                        apiCard.innerHTML = `
                        <h4 class="text-xl font-bold text-white mb-2">${api.name}</h4>
                        <p class="text-gray-400 font-mono mb-4">${api.basePath}</p>
                        <div class="flex flex-wrap gap-2">
                            ${activeFeaturesHtml || '<span class="text-gray-500 text-sm">No active features</span>'}
                        </div>
                    `;
                        apiList.appendChild(apiCard);
                    });
                }
            }

            function showApiDetails(apiId) {
                activeApiId = apiId;
                const api = apis.find((a) => a.id === apiId);
                if (!api) return;

                document.getElementById("modalApiName").innerText = api.name;
                document.getElementById("modalApiBasePath").innerText =
                    api.basePath;

                const togglesContainer = document.getElementById(
                    "modalFeatureToggles",
                );
                togglesContainer.innerHTML = "";
                features.forEach((feature) => {
                    const isActive = api.activeFeatures.includes(feature.id);
                    const toggleEl = document.createElement("div");
                    toggleEl.className =
                        "flex items-center justify-between bg-gray-700/50 p-4 rounded-lg";
                    toggleEl.innerHTML = `
                    <div>
                        <h5 class="font-semibold text-white">${feature.name}</h5>
                        <p class="text-sm text-gray-400">${feature.description}</p>
                    </div>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" onchange="toggleApiFeature(${api.id}, ${feature.id})" name="toggle-${feature.id}" id="toggle-${feature.id}" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" ${isActive ? "checked" : ""}/>
                        <label for="toggle-${feature.id}" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                `;
                    togglesContainer.appendChild(toggleEl);
                });

                openModal("apiDetailsModal");
            }

            // --- EVENT HANDLERS & LOGIC ---
            function addFeatures(featureArray) {
                if (!Array.isArray(featureArray)) {
                    // For backwards compatibility, handle single object upload
                    featureArray = [featureArray];
                }

                let addedCount = 0;
                featureArray.forEach((featureData) => {
                    if (featureData.name && featureData.description) {
                        const newFeature = {
                            id: Date.now() + Math.random(), // Add random to prevent collision on rapid adds
                            name: featureData.name,
                            description: featureData.description,
                        };
                        // Avoid duplicates by name
                        if (!features.some((f) => f.name === newFeature.name)) {
                            features.push(newFeature);
                            addedCount++;
                        }
                    }
                });

                if (addedCount === 0) {
                    alert(
                        'Invalid or duplicate feature file. Each feature must contain "name" and "description".',
                    );
                }
                renderFeatures();
            }

            function removeFeature(featureId) {
                features = features.filter((f) => f.id !== featureId);
                // Also remove this feature from any APIs that use it
                apis.forEach((api) => {
                    api.activeFeatures = api.activeFeatures.filter(
                        (fid) => fid !== featureId,
                    );
                });
                renderFeatures();
                renderApis();
            }

            function addApi(apiData) {
                if (!apiData.name || !apiData.basePath) {
                    alert(
                        'Invalid API file. Must contain "name" and "basePath".',
                    );
                    return;
                }
                const newApi = {
                    id: Date.now(),
                    name: apiData.name,
                    basePath: apiData.basePath,
                    activeFeatures: apiData.activeFeatures || [],
                };
                apis.push(newApi);
                renderApis();
            }

            function removeApi() {
                if (!activeApiId) return;
                if (confirm("Are you sure you want to remove this API?")) {
                    apis = apis.filter((a) => a.id !== activeApiId);
                    closeModal("apiDetailsModal");
                    renderApis();
                    activeApiId = null;
                }
            }

            function toggleApiFeature(apiId, featureId) {
                const api = apis.find((a) => a.id === apiId);
                if (!api) return;

                const featureIndex = api.activeFeatures.indexOf(featureId);
                if (featureIndex > -1) {
                    api.activeFeatures.splice(featureIndex, 1);
                } else {
                    api.activeFeatures.push(featureId);
                }
                renderApis();
            }

            function downloadApi(format) {
                const api = apis.find((a) => a.id === activeApiId);
                if (!api) return;
                alert(
                    `Downloading ${api.name} as a ${format.toUpperCase()} file... (This is a demo)`,
                );
            }

            function downloadSingleFeature(featureId) {
                const feature = features.find((f) => f.id === featureId);
                if (!feature) {
                    alert("Feature not found.");
                    return;
                }
                // Create a version of the feature without the generated 'id' for a cleaner export
                const exportableFeature = {
                    name: feature.name,
                    description: feature.description,
                };
                const dataStr =
                    "data:text/json;charset=utf-8," +
                    encodeURIComponent(
                        JSON.stringify(exportableFeature, null, 2),
                    );
                const downloadAnchorNode = document.createElement("a");
                downloadAnchorNode.setAttribute("href", dataStr);
                const fileName = `${feature.name.replace(/\s+/g, "_")}.json`;
                downloadAnchorNode.setAttribute("download", fileName);
                document.body.appendChild(downloadAnchorNode); // required for firefox
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            }

            function handleFileUpload(event, handler) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        handler(data);
                    } catch (error) {
                        alert(
                            "Error parsing file. Please ensure it is a valid JSON.",
                        );
                        console.error("File parsing error:", error);
                    }
                };
                reader.readAsText(file);
                event.target.value = ""; // Reset input
            }

            // --- EVENT LISTENERS ---
            manageFeaturesBtn.addEventListener("click", () =>
                openModal("featuresModal"),
            );

            // Close modals on escape key
            window.addEventListener("keydown", (e) => {
                if (e.key === "Escape") {
                    closeModal("featuresModal");
                    closeModal("apiDetailsModal");
                }
            });

            // Close modals on backdrop click
            featuresModal.addEventListener("click", (e) => {
                if (e.target === featuresModal) closeModal("featuresModal");
            });
            apiDetailsModal.addEventListener("click", (e) => {
                if (e.target === apiDetailsModal) closeModal("apiDetailsModal");
            });

            uploadFeatureInput.addEventListener("change", (e) =>
                handleFileUpload(e, addFeatures),
            );

            uploadApiInput.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (file.type === "application/json") {
                    handleFileUpload(e, addApi);
                } else {
                    // Simulate handling for other file types
                    const fakeApiData = {
                        name: file.name.replace(/\.(zip|yaml|yml)$/i, ""),
                        basePath: `/v1/${file.name.split(".")[0].toLowerCase()}`,
                    };
                    addApi(fakeApiData);
                    alert(
                        `Successfully uploaded ${file.name}. (YAML/ZIP parsing is simulated)`,
                    );
                    e.target.value = ""; // Reset input
                }
            });

            removeApiBtn.addEventListener("click", removeApi);

            // --- INITIAL RENDER ---
            document.addEventListener("DOMContentLoaded", () => {
                renderFeatures();
                renderApis();
            });
        </script>
    </body>
</html>
