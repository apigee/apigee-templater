<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>API File Importer</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            body {
                font-family: "Inter", sans-serif;
            }
            .drag-over {
                border-color: #3b82f6;
                background-color: #1e293b;
            }
            .modal-backdrop {
                background-color: rgba(0, 0, 0, 0.5);
            }
            .file-item:hover .actions {
                opacity: 1;
            }
        </style>
    </head>
    <body class="bg-slate-900 text-white antialiased">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="w-full max-w-2xl mx-auto">
                <!-- Header -->
                <header class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-slate-100">
                        Apigee Proxy Manager
                    </h1>
                    <p class="text-slate-400 mt-2">
                        Upload JSON or ZIP files to import data.
                    </p>
                </header>

                <!-- File Upload Area -->
                <div
                    id="drop-zone"
                    class="border-2 border-dashed border-slate-600 rounded-lg p-8 text-center cursor-pointer transition-all duration-300 hover:border-blue-500 hover:bg-slate-800"
                >
                    <input
                        type="file"
                        id="file-input"
                        class="hidden"
                        accept=".json,.zip"
                        multiple
                    />
                    <div class="flex flex-col items-center">
                        <svg
                            class="w-12 h-12 text-slate-500 mb-4"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M7 16a4 4 0 01-4-4V7a4 4 0 014-4h2a4 4 0 014 4v1m-1 8l-2-2m2 2l2-2m-2 2v-2m5 2a4 4 0 004-4V7a4 4 0 00-4-4h-2a4 4 0 00-4 4v1m0 9h.01"
                            ></path>
                        </svg>
                        <p class="text-slate-300 font-medium">
                            Drag & drop your files here
                        </p>
                        <p class="text-slate-500 text-sm mt-1">
                            or
                            <span class="text-blue-400 font-semibold"
                                >click to browse</span
                            >
                        </p>
                        <p class="text-xs text-slate-600 mt-4">
                            Supports: JSON, ZIP
                        </p>
                    </div>
                </div>

                <!-- Uploaded Files List -->
                <div id="file-list-container" class="mt-8">
                    <h2 class="text-lg font-semibold text-slate-300 mb-4">
                        Uploaded Files
                    </h2>
                    <ul id="file-list" class="space-y-3">
                        <!-- File items will be dynamically inserted here -->
                    </ul>
                    <p id="empty-state" class="text-center text-slate-500 py-8">
                        No files uploaded yet.
                    </p>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div
            id="delete-modal"
            class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden"
        >
            <div class="bg-slate-800 rounded-lg shadow-xl p-6 w-full max-w-sm">
                <h3 class="text-lg font-semibold text-white">
                    Confirm Deletion
                </h3>
                <p class="text-slate-400 mt-2">
                    Are you sure you want to delete
                    <strong
                        id="file-to-delete-name"
                        class="font-medium text-slate-300"
                    ></strong
                    >? This action cannot be undone.
                </p>
                <div class="mt-6 flex justify-end space-x-3">
                    <button
                        id="cancel-delete-btn"
                        class="px-4 py-2 rounded-md bg-slate-700 text-white font-medium hover:bg-slate-600 transition-colors"
                    >
                        Cancel
                    </button>
                    <button
                        id="confirm-delete-btn"
                        class="px-4 py-2 rounded-md bg-red-600 text-white font-medium hover:bg-red-500 transition-colors"
                    >
                        Delete
                    </button>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const dropZone = document.getElementById("drop-zone");
                const fileInput = document.getElementById("file-input");
                const fileList = document.getElementById("file-list");
                const emptyState = document.getElementById("empty-state");
                const deleteModal = document.getElementById("delete-modal");
                const fileToDeleteName = document.getElementById(
                    "file-to-delete-name",
                );
                const cancelDeleteBtn =
                    document.getElementById("cancel-delete-btn");
                const confirmDeleteBtn =
                    document.getElementById("confirm-delete-btn");

                let files = [];
                let fileToDeleteId = null;
                let fileIdCounter = 0;

                // Mock initial files
                const initialFiles = [
                    {
                        name: "project_data.json",
                        size: 128 * 1024,
                        type: "application/json",
                    },
                    {
                        name: "assets_v1.zip",
                        size: 2.5 * 1024 * 1024,
                        type: "application/zip",
                    },
                    {
                        name: "user_profiles.json",
                        size: 512 * 1024,
                        type: "application/json",
                    },
                ];
                initialFiles.forEach((file) => addFileToList(file));

                // --- Event Listeners ---

                dropZone.addEventListener("click", () => fileInput.click());
                fileInput.addEventListener("change", (e) =>
                    handleFiles(e.target.files),
                );

                ["dragenter", "dragover", "dragleave", "drop"].forEach(
                    (eventName) => {
                        dropZone.addEventListener(
                            eventName,
                            preventDefaults,
                            false,
                        );
                    },
                );

                ["dragenter", "dragover"].forEach((eventName) => {
                    dropZone.addEventListener(
                        eventName,
                        () => dropZone.classList.add("drag-over"),
                        false,
                    );
                });

                ["dragleave", "drop"].forEach((eventName) => {
                    dropZone.addEventListener(
                        eventName,
                        () => dropZone.classList.remove("drag-over"),
                        false,
                    );
                });

                dropZone.addEventListener(
                    "drop",
                    (e) => handleFiles(e.dataTransfer.files),
                    false,
                );

                cancelDeleteBtn.addEventListener("click", closeModal);
                confirmDeleteBtn.addEventListener("click", () => {
                    if (fileToDeleteId !== null) {
                        deleteFile(fileToDeleteId);
                    }
                    closeModal();
                });

                // --- Functions ---

                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                function handleFiles(uploadedFiles) {
                    [...uploadedFiles].forEach(addFileToList);
                }

                function addFileToList(file) {
                    const fileId = fileIdCounter++;
                    const newFile = {
                        id: fileId,
                        name: file.name,
                        size: file.size,
                        type: file.type || getFileType(file.name),
                        uploadDate: new Date(),
                    };
                    files.push(newFile);
                    renderFileList();
                }

                function getFileType(fileName) {
                    if (fileName.endsWith(".json")) return "application/json";
                    if (fileName.endsWith(".zip")) return "application/zip";
                    return "application/octet-stream";
                }

                function renderFileList() {
                    fileList.innerHTML = "";
                    if (files.length === 0) {
                        emptyState.classList.remove("hidden");
                    } else {
                        emptyState.classList.add("hidden");
                        // Sort by newest first
                        files.sort((a, b) => b.uploadDate - a.uploadDate);
                        files.forEach((file) => {
                            const listItem = document.createElement("li");
                            listItem.className =
                                "file-item bg-slate-800 p-4 rounded-lg flex items-center justify-between transition-shadow hover:shadow-lg";
                            listItem.dataset.fileId = file.id;

                            const isJson = file.type === "application/json";
                            const iconSvg = isJson
                                ? `<svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>`
                                : `<svg class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>`;

                            listItem.innerHTML = `
                            <div class="flex items-center space-x-4">
                                ${iconSvg}
                                <div class="flex-grow">
                                    <p class="font-medium text-slate-200 file-name">${file.name}</p>
                                    <p class="text-sm text-slate-400">
                                        ${formatFileSize(file.size)} &bull; Uploaded on ${formatDate(file.uploadDate)}
                                    </p>
                                </div>
                            </div>
                            <div class="actions opacity-0 transition-opacity flex items-center space-x-2">
                                <button class="edit-btn p-2 text-slate-400 hover:text-blue-400" title="Edit">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"></path></svg>
                                </button>
                                <button class="delete-btn p-2 text-slate-400 hover:text-red-400" title="Delete">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div>
                        `;
                            fileList.appendChild(listItem);
                        });
                        addListItemListeners();
                    }
                }

                function addListItemListeners() {
                    document.querySelectorAll(".delete-btn").forEach((btn) => {
                        btn.addEventListener("click", (e) => {
                            const listItem =
                                e.currentTarget.closest(".file-item");
                            const fileId = parseInt(listItem.dataset.fileId);
                            const file = files.find((f) => f.id === fileId);
                            if (file) {
                                openModal(file.id, file.name);
                            }
                        });
                    });

                    document.querySelectorAll(".edit-btn").forEach((btn) => {
                        btn.addEventListener("click", (e) => {
                            const listItem =
                                e.currentTarget.closest(".file-item");
                            const fileId = parseInt(listItem.dataset.fileId);
                            toggleEditState(listItem, fileId);
                        });
                    });
                }

                function toggleEditState(listItem, fileId) {
                    const fileNameEl = listItem.querySelector(".file-name");
                    const currentName = fileNameEl.textContent;

                    const input = document.createElement("input");
                    input.type = "text";
                    input.value = currentName;
                    input.className =
                        "bg-slate-700 text-slate-100 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500";

                    fileNameEl.replaceWith(input);
                    input.focus();
                    input.select();

                    const save = () => {
                        const newName = input.value.trim();
                        if (newName && newName !== currentName) {
                            updateFileName(fileId, newName);
                        } else {
                            renderFileList(); // Re-render to restore original name
                        }
                    };

                    input.addEventListener("blur", save);
                    input.addEventListener("keydown", (e) => {
                        if (e.key === "Enter") {
                            save();
                        } else if (e.key === "Escape") {
                            renderFileList(); // Re-render to cancel
                        }
                    });
                }

                function updateFileName(fileId, newName) {
                    const file = files.find((f) => f.id === fileId);
                    if (file) {
                        file.name = newName;
                    }
                    renderFileList();
                }

                function deleteFile(fileId) {
                    files = files.filter((f) => f.id !== fileId);
                    renderFileList();
                }

                function openModal(fileId, fileName) {
                    fileToDeleteId = fileId;
                    fileToDeleteName.textContent = fileName;
                    deleteModal.classList.remove("hidden");
                }

                function closeModal() {
                    fileToDeleteId = null;
                    deleteModal.classList.add("hidden");
                }

                function formatFileSize(bytes) {
                    if (bytes === 0) return "0 Bytes";
                    const k = 1024;
                    const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return (
                        parseFloat((bytes / Math.pow(k, i)).toFixed(2)) +
                        " " +
                        sizes[i]
                    );
                }

                function formatDate(date) {
                    return date.toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "short",
                        day: "numeric",
                    });
                }

                // Initial Render
                renderFileList();
            });
        </script>
    </body>
</html>
