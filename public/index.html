<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>API and Feature Manager</title>
        <!-- Tailwind CSS for styling -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- js-yaml for YAML file handling -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
        <!-- jszip for ZIP file handling -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
        <!-- Font Awesome for icons -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <style>
            /* Custom scrollbar for a modern look */
            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }
            ::-webkit-scrollbar-track {
                background: #1f2937; /* bg-gray-800 */
            }
            ::-webkit-scrollbar-thumb {
                background: #4b5563; /* bg-gray-600 */
                border-radius: 4px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #6b7280; /* bg-gray-500 */
            }
            /* Style for the file input button */
            .file-input-button {
                cursor: pointer;
            }
            /* Simple transition for UI elements */
            .transition-all {
                transition: all 0.3s ease-in-out;
            }
        </style>
    </head>
    <body class="bg-gray-900 text-gray-200 font-sans flex flex-col h-screen">
        <!-- Main Header -->
        <header
            class="p-4 border-b border-gray-700 shadow-lg bg-gray-800/50 backdrop-blur-sm"
        >
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold text-white">API Dashboard</h1>
                <button
                    id="manage-features-btn"
                    class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg transition-all shadow-md hover:shadow-lg"
                >
                    <i class="fas fa-cogs mr-2"></i>Manage Features
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="container mx-auto p-4 flex-grow flex flex-col">
            <!-- File Upload Section -->
            <div class="mb-4">
                <label
                    for="api-file-upload"
                    class="file-input-button w-full text-center bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center cursor-pointer"
                >
                    <i class="fas fa-upload mr-3"></i>
                    <span>Upload API File (JSON, YAML, or ZIP)</span>
                </label>
                <input
                    type="file"
                    id="api-file-upload"
                    class="hidden"
                    accept=".json,.yaml,.yml,.zip"
                />
                <p
                    id="upload-status"
                    class="text-sm text-gray-400 mt-2 h-5"
                ></p>
            </div>

            <!-- Tabs Section -->
            <div
                class="flex-grow flex flex-col bg-gray-800 rounded-lg shadow-inner overflow-hidden"
            >
                <!-- Tab Buttons -->
                <div class="flex border-b border-gray-700">
                    <button
                        data-tab="zip"
                        class="tab-btn flex-1 py-3 px-4 font-semibold text-gray-400 hover:bg-gray-700/50 transition-all"
                    >
                        <i class="fas fa-file-archive mr-2"></i>ZIP Contents
                    </button>
                    <button
                        data-tab="json"
                        class="tab-btn flex-1 py-3 px-4 font-semibold text-gray-400 hover:bg-gray-700/50 transition-all"
                    >
                        <i class="fas fa-code mr-2"></i>JSON View
                    </button>
                    <button
                        data-tab="yaml"
                        class="tab-btn flex-1 py-3 px-4 font-semibold text-gray-400 hover:bg-gray-700/50 transition-all"
                    >
                        <i class="fas fa-file-alt mr-2"></i>YAML View
                    </button>
                </div>
                <!-- Tab Panels -->
                <div class="flex-grow p-1 relative">
                    <div id="zip-panel" class="tab-panel hidden h-full">
                        <pre
                            class="h-full overflow-auto p-4 text-sm"
                        ><code id="zip-content">Upload a ZIP file to see its contents.</code></pre>
                    </div>
                    <div id="json-panel" class="tab-panel hidden h-full">
                        <pre
                            class="h-full overflow-auto p-4 text-sm"
                        ><code id="json-content">Upload an API file to see the JSON representation.</code></pre>
                    </div>
                    <div id="yaml-panel" class="tab-panel hidden h-full">
                        <pre
                            class="h-full overflow-auto p-4 text-sm"
                        ><code id="yaml-content">Upload an API file to see the YAML representation.</code></pre>
                    </div>
                </div>
            </div>
        </main>

        <!-- Features Modal -->
        <div
            id="features-modal"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden transition-opacity duration-300"
        >
            <div
                class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col transform scale-95 transition-transform duration-300"
            >
                <!-- Modal Header -->
                <div
                    class="flex justify-between items-center p-4 border-b border-gray-700"
                >
                    <h2 class="text-xl font-bold">Feature Management</h2>
                    <button
                        id="close-modal-btn"
                        class="text-gray-400 hover:text-white text-2xl"
                    >
                        &times;
                    </button>
                </div>
                <!-- Modal Body -->
                <div id="features-list" class="p-4 space-y-3 overflow-y-auto">
                    <!-- Feature items will be injected here -->
                    <p class="text-gray-400">
                        No features added yet. Upload a feature JSON file to get
                        started.
                    </p>
                </div>
                <!-- Modal Footer -->
                <div class="p-4 border-t border-gray-700 mt-auto">
                    <label
                        for="add-feature-upload"
                        class="file-input-button w-full text-center bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center"
                    >
                        <i class="fas fa-plus mr-2"></i>Add Feature from JSON
                    </label>
                    <input
                        type="file"
                        id="add-feature-upload"
                        class="hidden"
                        accept=".json"
                    />
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // --- State ---
                let features = [];

                // --- DOM Elements ---
                const manageFeaturesBtn = document.getElementById(
                    "manage-features-btn",
                );
                const featuresModal = document.getElementById("features-modal");
                const closeModalBtn =
                    document.getElementById("close-modal-btn");
                const featuresList = document.getElementById("features-list");
                const addFeatureUpload =
                    document.getElementById("add-feature-upload");
                const apiFileUpload =
                    document.getElementById("api-file-upload");
                const uploadStatus = document.getElementById("upload-status");
                const tabButtons = document.querySelectorAll(".tab-btn");
                const tabPanels = document.querySelectorAll(".tab-panel");
                const zipContent = document.getElementById("zip-content");
                const jsonContent = document.getElementById("json-content");
                const yamlContent = document.getElementById("yaml-content");

                // --- Feature Management ---

                /**
                 * Renders the list of features in the modal.
                 */
                const renderFeatures = () => {
                    featuresList.innerHTML = ""; // Clear current list
                    if (features.length === 0) {
                        featuresList.innerHTML =
                            '<p class="text-gray-400">No features added yet. Upload a feature JSON file to get started.</p>';
                        return;
                    }
                    features.forEach((feature, index) => {
                        const featureElement = document.createElement("div");
                        featureElement.className =
                            "bg-gray-700 p-3 rounded-lg flex justify-between items-center animate-fade-in";
                        featureElement.innerHTML = `
                        <div>
                            <p class="font-bold text-white">${feature.name || "Unnamed Feature"}</p>
                            <p class="text-sm text-gray-400">${feature.description || "No description"}</p>
                        </div>
                        <button data-index="${index}" class="remove-feature-btn bg-red-600 hover:bg-red-500 text-white font-bold py-1 px-3 rounded-md transition-all">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                        featuresList.appendChild(featureElement);
                    });
                };

                /**
                 * Handles the addition of a new feature from a JSON file.
                 */
                addFeatureUpload.addEventListener("change", (event) => {
                    const file = event.target.files[0];
                    if (file && file.type === "application/json") {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const newFeature = JSON.parse(e.target.result);
                                // Can be a single object or an array of objects
                                if (Array.isArray(newFeature)) {
                                    features.push(...newFeature);
                                } else {
                                    features.push(newFeature);
                                }
                                renderFeatures();
                            } catch (error) {
                                alert("Error: Invalid JSON file.");
                                console.error("JSON parsing error:", error);
                            }
                        };
                        reader.readAsText(file);
                    } else if (file) {
                        alert("Please upload a valid JSON file.");
                    }
                    event.target.value = ""; // Reset file input
                });

                /**
                 * Handles removing a feature using event delegation.
                 */
                featuresList.addEventListener("click", (event) => {
                    if (event.target.closest(".remove-feature-btn")) {
                        const button = event.target.closest(
                            ".remove-feature-btn",
                        );
                        const indexToRemove = parseInt(
                            button.dataset.index,
                            10,
                        );
                        features.splice(indexToRemove, 1);
                        renderFeatures();
                    }
                });

                // --- Modal Logic ---
                const openModal = () => {
                    featuresModal.classList.remove("hidden");
                    setTimeout(() => {
                        featuresModal.classList.add("opacity-100");
                        featuresModal
                            .querySelector("div")
                            .classList.remove("scale-95");
                    }, 10);
                };

                const closeModal = () => {
                    featuresModal.classList.remove("opacity-100");
                    featuresModal
                        .querySelector("div")
                        .classList.add("scale-95");
                    setTimeout(() => {
                        featuresModal.classList.add("hidden");
                    }, 300);
                };

                manageFeaturesBtn.addEventListener("click", openModal);
                closeModalBtn.addEventListener("click", closeModal);
                featuresModal.addEventListener("click", (event) => {
                    if (event.target === featuresModal) {
                        closeModal();
                    }
                });

                // --- API File Handling & Tabs ---

                /**
                 * Sets the active tab and panel.
                 * @param {string} tabName - The name of the tab to activate ('zip', 'json', 'yaml').
                 */
                const setActiveTab = (tabName) => {
                    tabButtons.forEach((btn) => {
                        if (btn.dataset.tab === tabName) {
                            btn.classList.add("bg-gray-700", "text-white");
                            btn.classList.remove("text-gray-400");
                        } else {
                            btn.classList.remove("bg-gray-700", "text-white");
                            btn.classList.add("text-gray-400");
                        }
                    });
                    tabPanels.forEach((panel) => {
                        if (panel.id === `${tabName}-panel`) {
                            panel.classList.remove("hidden");
                        } else {
                            panel.classList.add("hidden");
                        }
                    });
                };

                tabButtons.forEach((button) => {
                    button.addEventListener("click", () => {
                        setActiveTab(button.dataset.tab);
                    });
                });

                /**
                 * Handles the main API file upload and processing.
                 */
                apiFileUpload.addEventListener("change", (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    uploadStatus.textContent = `Processing "${file.name}"...`;
                    resetContentViews();

                    const extension = file.name.split(".").pop().toLowerCase();

                    if (extension === "zip") {
                        handleZipFile(file);
                    } else if (extension === "json") {
                        handleJsonFile(file);
                    } else if (extension === "yaml" || extension === "yml") {
                        handleYamlFile(file);
                    } else {
                        uploadStatus.textContent = `Error: Unsupported file type ".${extension}".`;
                    }
                    event.target.value = ""; // Reset file input
                });

                const resetContentViews = () => {
                    zipContent.textContent = "Processing...";
                    jsonContent.textContent = "Processing...";
                    yamlContent.textContent = "Processing...";
                };

                const handleZipFile = (file) => {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const zip = await JSZip.loadAsync(e.target.result);
                            let fileTree = `Contents of ${file.name}:\n\n`;
                            zip.forEach((relativePath, zipEntry) => {
                                fileTree += `${zipEntry.dir ? "📁" : "📄"} ${relativePath}\n`;
                            });
                            zipContent.textContent = fileTree;
                            jsonContent.textContent =
                                "N/A for ZIP file view. Unpack to view contents.";
                            yamlContent.textContent =
                                "N/A for ZIP file view. Unpack to view contents.";
                            uploadStatus.textContent = `Successfully processed "${file.name}".`;
                            setActiveTab("zip");
                        } catch (error) {
                            uploadStatus.textContent = `Error processing ZIP file.`;
                            console.error(error);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                };

                const handleJsonFile = (file) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const parsedJson = JSON.parse(e.target.result);
                            jsonContent.textContent = JSON.stringify(
                                parsedJson,
                                null,
                                2,
                            );
                            // Convert JSON to YAML for the other tab
                            yamlContent.textContent = jsyaml.dump(parsedJson);
                            zipContent.textContent = "N/A for JSON file.";
                            uploadStatus.textContent = `Successfully processed "${file.name}".`;
                            setActiveTab("json");
                        } catch (error) {
                            uploadStatus.textContent = `Error: Invalid JSON file.`;
                            jsonContent.textContent = `Error parsing JSON:\n\n${error.message}`;
                            console.error(error);
                        }
                    };
                    reader.readAsText(file);
                };

                const handleYamlFile = (file) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const parsedYaml = jsyaml.load(e.target.result);
                            yamlContent.textContent = e.target.result;
                            // Convert YAML to JSON for the other tab
                            jsonContent.textContent = JSON.stringify(
                                parsedYaml,
                                null,
                                2,
                            );
                            zipContent.textContent = "N/A for YAML file.";
                            uploadStatus.textContent = `Successfully processed "${file.name}".`;
                            setActiveTab("yaml");
                        } catch (error) {
                            uploadStatus.textContent = `Error: Invalid YAML file.`;
                            yamlContent.textContent = `Error parsing YAML:\n\n${error.message}`;
                            console.error(error);
                        }
                    };
                    reader.readAsText(file);
                };

                // --- Initial Setup ---
                renderFeatures();
                setActiveTab("json"); // Set a default active tab on load
            });
        </script>
    </body>
</html>
