name: response-hello-world-text
type: feature
description: |
  A message text is added to the payload.

  ## Prerequisites
  - The message response is text.

  ## Inputs
  - A 'message' property is either sent as query parameter or retrieved from the properties file.

  ## Outputs
  - The message text is appended to the payload.
categories:
  - traffic
parameters:
  - name: MESSAGE
    displayName: MESSAGE
    description: Configuration input for MESSAGE
    default: Hello world!
    examples:
      - Hello mars!
      - Hello internet!
defaultEndpoint:
  name: default
  basePath: /feature-data-helloworld-v1
  routes:
    - name: default
  flows:
    - name: PostFlow
      mode: Response
      steps:
        - name: JS-AddHelloWorld
  faultRules: []
endpoints: []
targets: []
policies:
  - name: JS-AddHelloWorld
    type: Javascript
    content:
      Javascript:
        _attributes:
          continueOnError: "false"
          enabled: "true"
          timeLimit: "200"
          name: JS-AddHelloWorld
        DisplayName:
          _text: JS-AddHelloWorld
        Properties: {}
        ResourceURL:
          _text: jsc://hello-world.js
resources:
  - name: hello-world.js
    type: jsc
    content: |
      var responseText = response.content;
      if (!responseText) responseText = "";

      var message = context.getVariable("request.queryparam.message");
      if (!message)
        message = context.getVariable("propertyset.helloworld.MESSAGE");
      if (!message)
        message = "Hello world!";
      responseText += " " + message;
      context.setVariable("response.content", responseText);
  - name: helloworld.properties
    type: properties
    content: |
      MESSAGE={MESSAGE}
tests: []
