name: llm-extract-prompts-v1
type: feature
description: ""
parameters: []
endpointFlows:
  - name: PreFlow
    mode: Request
    steps:
      - name: EV-ExtractPromptContents
        condition: request.content != null
      - name: AM-SetPromptContents
targetFlows: []
endpoints: []
targets: []
policies:
  - name: AM-SetPromptContents
    type: AssignMessage
    content:
      AssignMessage:
        _attributes:
          async: "false"
          continueOnError: "false"
          enabled: "true"
          name: AM-SetPromptContents
        DisplayName:
          _text: AM-SetPromptContents
        Properties: {}
        AssignVariable:
          - Name:
              _text: prompt_parts_match
            Value:
              _text: \[(\s)*\"|\"(\s)*\]|\"(\s)*,(\s)*\"
          - Name:
              _text: prompt_contents_0
            Template:
              _text: "{replaceAll(prompt_parts,prompt_parts_match,' ')}"
          - Name:
              _text: prompt_contents_1
            Template:
              _text: "{substring(prompt_contents_0,200000)}"
          - Name:
              _text: prompt_contents_2
            Template:
              _text: "{substring(prompt_contents_0,400000)}"
          - Name:
              _text: prompt_contents_3
            Template:
              _text: "{substring(prompt_contents_0,600000)}"
          - Name:
              _text: prompt_contents_4
            Template:
              _text: "{substring(prompt_contents_0,800000)}"
        IgnoreUnresolvedVariables:
          _text: "true"
  - name: EV-ExtractPromptContents
    type: ExtractVariables
    content:
      ExtractVariables:
        _attributes:
          continueOnError: "false"
          enabled: "true"
          name: EV-ExtractPromptContents
        DisplayName:
          _text: EV-ExtractPromptContents
        Properties: {}
        IgnoreUnresolvedVariables:
          _text: "true"
        JSONPayload:
          Variable:
            _attributes:
              name: prompt_parts
              type: string
            JSONPath:
              _text: $.contents[*].parts[*].text
        Source:
          _attributes:
            clearPayload: "false"
          _text: request
resources: []
