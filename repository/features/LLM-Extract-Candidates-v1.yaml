name: llm-extract-candidates-v1
type: feature
description: ""
parameters: []
endpointFlows:
  - name: PreFlow
    mode: Request
    steps:
      - name: EV-ExtractCandidateContents
        condition: response.content != null
      - name: AM-SetCandidateContents
targetFlows: []
endpoints: []
targets: []
policies:
  - name: AM-SetCandidateContents
    type: AssignMessage
    content:
      AssignMessage:
        _attributes:
          async: "false"
          continueOnError: "false"
          enabled: "true"
          name: AM-SetCandidateContents
        DisplayName:
          _text: AM-SetCandidateContents
        Properties: {}
        AssignVariable:
          - Name:
              _text: candidate_parts_match
            Value:
              _text: \[(\s)*\"|\"(\s)*\]|\"(\s)*,(\s)*\"
          - Name:
              _text: candidate_contents_0
            Template:
              _text: "{replaceAll(candidate_parts,candidate_parts_match,' ')}"
          - Name:
              _text: candidate_contents_1
            Template:
              _text: "{substring(candidate_contents_0,200000)}"
          - Name:
              _text: candidate_contents_2
            Template:
              _text: "{substring(candidate_contents_0,400000)}"
          - Name:
              _text: candidate_contents_3
            Template:
              _text: "{substring(candidate_contents_0,600000)}"
          - Name:
              _text: candidate_contents_4
            Template:
              _text: "{substring(candidate_contents_0,800000)}"
        IgnoreUnresolvedVariables:
          _text: "true"
  - name: EV-ExtractCandidateContents
    type: ExtractVariables
    content:
      ExtractVariables:
        _attributes:
          continueOnError: "false"
          enabled: "true"
          name: EV-ExtractCandidateContents
        DisplayName:
          _text: EV-ExtractCandidateContents
        Properties: {}
        IgnoreUnresolvedVariables:
          _text: "true"
        JSONPayload:
          Variable:
            _attributes:
              name: candidate_parts
              type: string
            JSONPath:
              _text: $.candidates[*].content.parts[*].text
        Source:
          _attributes:
            clearPayload: "false"
          _text: response
resources: []
