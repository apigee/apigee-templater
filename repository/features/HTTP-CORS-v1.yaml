name: HTTP-CORS-v1
type: feature
description: |
  This feature adds CORS handling to a proxy, with parameters for the allowed origins, methods and headers,
  and allowing developer portal web applications to also access API endpoints for 'Try It Out' features.

  ## Prerequisites
  None.

  ## Inputs
  None.

  ## Outputs
  - The allowed headers are set according to the configuration, enabling CORS requests to be answered for allowed requests.
parameters:
  - name: ALLOWED_ORIGINS
    description: The allowed origins of clients.
    default: "*"
    examples:
      - "*"
      - "{request.header.origin}"
  - name: ALLOWED_HEADERS
    description: The allowed headers for clients to send.
    default: "origin, x-requested-with, accept, content-type"
    examples:
      - "origin, x-requested-with, accept, content-type"
  - name: ALLOWED_METHODS
    description: The allowed methods for clients to use.
    default: "GET, PUT, POST, DELETE"
    examples:
      - "GET, PUT, POST, DELETE"
endpointFlows:
  - name: OptionsPreFlight
    mode: Request
    condition: request.verb == "OPTIONS" AND request.header.origin != null AND
      request.header.Access-Control-Request-Method != null
    steps:
      - name: CORS-AddCors
targetFlows:
  - name: PreFlow
    mode: Request
    steps:
      - name: CORS-AddCors
endpoints: []
targets: []
policies:
  - name: CORS-AddCors
    type: CORS
    content:
      CORS:
        _attributes:
          continueOnError: "false"
          enabled: "true"
          name: CORS-AddCors
        DisplayName:
          _text: CORS-AddCors
        AllowOrigins:
          _text: "{ALLOWED_ORIGINS}"
        AllowMethods:
          _text: "{ALLOWED_METHODS}"
        AllowHeaders:
          _text: "{ALLOWED_HEADERS}"
        ExposeHeaders:
          _text: "*"
        MaxAge:
          _text: "3628800"
        AllowCredentials:
          _text: "false"
        GeneratePreflightResponse:
          _text: "true"
        IgnoreUnresolvedVariables:
          _text: "true"
resources: []
