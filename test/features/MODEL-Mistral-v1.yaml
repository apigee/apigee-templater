name: Feature-MODEL-Mistral-v1
type: feature
description: Proxy for Feature-MODEL-Mistral-v1
parameters:
  - name: PROJECT_ID
    description: Configuration input for PROJECT_ID
    default: apigee-prod13
    examples: []
  - name: REGION
    description: Configuration input for REGION
    default: us-central1
    examples: []
  - name: MODEL_ID
    description: Configuration input for MODEL_ID
    default: mistral-large-2411
    examples: []
endpointFlows: []
targetFlows: []
endpoints:
  - name: mistral
    basePath: /v1/mistral
    routes:
      - name: default
        target: mistral
    flows: []
    faultRules: []
targets:
  - name: mistral
    url: https://{propertyset.mistral.REGION}-aiplatform.googleapis.com/v1/projects/{propertyset.mistral.PROJECT_ID}/locations/{propertyset.mistral.REGION}/publishers/mistralai/models/{propertyset.mistral.MODEL_ID}:rawPredict
    auth: GoogleAccessToken
    scopes:
      - https://www.googleapis.com/auth/cloud-platform
    flows:
      - name: PostFlow
        mode: Response
        steps:
          - name: EV-GetTokenCounts
      - name: EventFlow
        mode: Response
        steps: []
    faultRules: []
    httpTargetConnection:
      Properties: {}
      URL:
        _text: https://{propertyset.mistral.REGION}-aiplatform.googleapis.com/v1/projects/{propertyset.mistral.PROJECT_ID}/locations/{propertyset.mistral.REGION}/publishers/mistralai/models/{propertyset.mistral.MODEL_ID}:rawPredict
      Authentication:
        GoogleAccessToken:
          Scopes:
            Scope:
              _text: https://www.googleapis.com/auth/cloud-platform
policies:
  - name: EV-GetTokenCounts
    type: ExtractVariables
    content:
      ExtractVariables:
        _attributes:
          continueOnError: "false"
          enabled: "true"
          name: EV-GetTokenCounts
        DisplayName:
          _text: EV-GetTokenCounts
        Properties: {}
        IgnoreUnresolvedVariables:
          _text: "true"
        Variable:
          _attributes:
            name: model
          Pattern:
            _text: "{propertyset.mistral.MODEL_ID}"
        JSONPayload:
          Variable:
            - _attributes:
                name: promptTokenCount
              JSONPath:
                _text: $.usage.prompt_tokens
            - _attributes:
                name: responseTokenCount
              JSONPath:
                _text: $.usage.completion_tokens
            - _attributes:
                name: totalTokenCount
              JSONPath:
                _text: $.usage.total_tokens
        Source:
          _attributes:
            clearPayload: "false"
          _text: response
        VariablePrefix:
          _text: llm
resources:
  - name: mistral.properties
    type: properties
    content: |-
      PROJECT_ID=apigee-prod13
      REGION=us-central1
      MODEL_ID=mistral-large-2411
